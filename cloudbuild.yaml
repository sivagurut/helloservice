steps:
# Build the openjdk image
- name: gcr.io/cloud-builders/docker
  args: ['build', '.', '-f', 'Dockerfile.builder', '-t', 'builder']
- name: 'builder'
  args:
  - 'clean'
  - 'install'
  - '--batch-mode'
  - '-Ddocker.image.name=gcr.io/$PROJECT_ID/hello-service'

  - '--also-make'
  id: 'MVN_PACKAGE'


  # push the container image to Container Registry
  - name: gcr.io/cloud-builders/docker
    args: [ push, gcr.io/$PROJECT_ID/hello-service]
  # Deploy container image to Cloud Run
  - name: 'gcr.io/cloud-builders/gcloud'
    args: ['run', 'deploy', 'hello-service', '--image', 'gcr.io/$PROJECT_ID/hello-service', '--region', 'us-central1', '--platform', 'managed', '--allow-unauthenticated']
images:
- gcr.io/$PROJECT_ID/hello-service
